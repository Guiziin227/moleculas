# Arquitetura do Projeto

## Vis√£o Geral

O Visualizador de Mol√©culas PDB √© uma aplica√ß√£o web que utiliza uma arquitetura modular baseada em JavaScript vanilla e Three.js. O projeto foi refatorado de uma implementa√ß√£o monol√≠tica para uma estrutura modular, facilitando a manuten√ß√£o e extensibilidade.

## Diagrama de Arquitetura

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        index.html                            ‚îÇ
‚îÇ  (Interface do Usu√°rio + Orquestra√ß√£o dos M√≥dulos)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
             ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
             ‚îÇ                                                   ‚îÇ
             ‚ñº                                                   ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  fileLoader.js ‚îÇ                              ‚îÇ  sceneManager.js   ‚îÇ
    ‚îÇ                ‚îÇ                              ‚îÇ                    ‚îÇ
    ‚îÇ ‚Ä¢ Carrega PDB  ‚îÇ                              ‚îÇ ‚Ä¢ Inicializa cena  ‚îÇ
    ‚îÇ ‚Ä¢ Upload File  ‚îÇ                              ‚îÇ ‚Ä¢ Controles        ‚îÇ
    ‚îÇ ‚Ä¢ UI Events    ‚îÇ                              ‚îÇ ‚Ä¢ Raycasting       ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ                                                 ‚îÇ
             ‚ñº                                                 ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                        ‚îÇ
    ‚îÇ  pdbParser.js  ‚îÇ                                        ‚îÇ
    ‚îÇ                ‚îÇ                                        ‚îÇ
    ‚îÇ ‚Ä¢ Parse PDB    ‚îÇ                                        ‚îÇ
    ‚îÇ ‚Ä¢ Extrai dados ‚îÇ                                        ‚îÇ
    ‚îÇ ‚Ä¢ CONECT       ‚îÇ                                        ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                        ‚îÇ
             ‚îÇ                                                 ‚îÇ
             ‚ñº                                                 ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ              moleculeRenderer.js                           ‚îÇ
    ‚îÇ                                                            ‚îÇ
    ‚îÇ  ‚Ä¢ Renderiza √°tomos (esferas)                             ‚îÇ
    ‚îÇ  ‚Ä¢ Cria liga√ß√µes (cilindros)                              ‚îÇ
    ‚îÇ  ‚Ä¢ Sistema h√≠brido: CONECT + dist√¢ncia                    ‚îÇ
    ‚îÇ  ‚Ä¢ Cores CPK                                              ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## Fluxo de Dados

### 1. Carregamento de Arquivo

```
Usu√°rio seleciona arquivo
        ‚Üì
fileLoader.js carrega o conte√∫do
        ‚Üì
pdbParser.js faz o parsing
        ‚Üì
Retorna {atoms: [], connections: []}
        ‚Üì
moleculeRenderer.js cria a mol√©cula 3D
        ‚Üì
sceneManager.js centraliza e exibe
```

### 2. Intera√ß√£o do Usu√°rio

```
Usu√°rio clica na cena
        ‚Üì
sceneManager.js detecta clique (raycasting)
        ‚Üì
Identifica √°tomo clicado
        ‚Üì
Exibe informa√ß√µes do elemento
```

## M√≥dulos Detalhados

### üìÅ fileLoader.js

**Responsabilidade**: Gerenciamento de arquivos e interface do usu√°rio

**Depend√™ncias**: 
- pdbParser.js (para processar dados)
- sceneManager.js (para limpar cena)
- moleculeRenderer.js (para renderizar)

**Fun√ß√µes p√∫blicas**:
- `loadPDB(url, onSuccess, onError)`: Carrega arquivo via URL
- `handleFileSelect(event, onSuccess)`: Processa upload do usu√°rio
- `setupFileSelector(onLoadCallback)`: Configura eventos da UI

**Fluxo interno**:
1. Captura evento de sele√ß√£o
2. L√™ arquivo (FileReader API ou fetch)
3. Chama callback com dados brutos
4. Trata erros de carregamento

---

### üìÅ pdbParser.js

**Responsabilidade**: Parsing e interpreta√ß√£o de arquivos PDB

**Depend√™ncias**: Nenhuma (m√≥dulo puro)

**Estrutura de dados de sa√≠da**:
```javascript
{
  atoms: [
    {
      serial: 1,
      name: "CA",
      element: "C",
      x: 10.5,
      y: 20.3,
      z: -5.8
    },
    // ...
  ],
  connections: [
    {
      from: 1,
      to: [2, 3, 4]
    },
    // ...
  ]
}
```

**Fun√ß√µes p√∫blicas**:
- `parsePDB(data)`: Processa string PDB completa
- `extractElement(line)`: Extrai s√≠mbolo qu√≠mico

**L√≥gica de parsing**:
1. Divide arquivo em linhas
2. Identifica registros ATOM/HETATM
3. Extrai coordenadas (colunas fixas)
4. Detecta elemento qu√≠mico (m√∫ltiplas estrat√©gias)
5. Processa registros CONECT
6. Retorna estrutura normalizada

**Estrat√©gias de detec√ß√£o de elemento**:
- Colunas 77-78 (padr√£o PDB)
- Colunas 13-16 (nome do √°tomo)
- Valida√ß√£o de elementos de 2 letras

---

### üìÅ moleculeRenderer.js

**Responsabilidade**: Renderiza√ß√£o 3D de mol√©culas

**Depend√™ncias**: 
- Three.js (biblioteca externa)

**Fun√ß√µes p√∫blicas**:
- `createMolecule(atoms, connections, scene)`: Renderiza mol√©cula completa
- `getAtomColor(element)`: Retorna cor CPK
- `createBond(atom1, atom2, group, length)`: Cria liga√ß√£o individual

**Fun√ß√µes internas**:
- `createBondsFromConect(atomMap, connections, group)`: Usa dados CONECT
- `createBondsFromDistance(atoms, group)`: Calcula liga√ß√µes automaticamente
- `getCovalentRadius(element)`: Retorna raio covalente

**Sistema H√≠brido de Liga√ß√µes**:

```javascript
if (connections && connections.length > 0) {
  // Usa dados expl√≠citos do arquivo PDB
  createBondsFromConect(atomMap, connections, moleculeGroup);
} else {
  // Calcula automaticamente por dist√¢ncia
  createBondsFromDistance(atoms, moleculeGroup);
}
```

**Crit√©rios de liga√ß√£o autom√°tica**:
- Dist√¢ncia entre √°tomos < (raio1 + raio2) √ó 1.3
- Usa raios covalentes tabelados
- Evita liga√ß√µes duplicadas

**Renderiza√ß√£o de √°tomos**:
- Geometria: SphereGeometry(raio, 32, 32)
- Material: MeshLambertMaterial (responde √† luz)
- Raio padr√£o: 0.5 unidades
- Cores: Padr√£o CPK

**Renderiza√ß√£o de liga√ß√µes**:
- Geometria: CylinderGeometry(0.15, 0.15, comprimento, 8)
- Material: MeshBasicMaterial (cor cinza)
- Orienta√ß√£o: Calculada via quaternions

---

### üìÅ sceneManager.js

**Responsabilidade**: Gerenciamento da cena Three.js e intera√ß√µes

**Depend√™ncias**: 
- Three.js
- OrbitControls.js

**Fun√ß√µes p√∫blicas**:
- `initScene()`: Inicializa√ß√£o completa
- `clearScene()`: Remove objetos
- `getScene()`: Acesso √† cena
- `animate()`: Loop de renderiza√ß√£o

**Configura√ß√£o da cena**:
```javascript
Scene (fundo preto)
  ‚îú‚îÄ‚îÄ Camera (PerspectiveCamera, FOV 75¬∞)
  ‚îú‚îÄ‚îÄ Lights
  ‚îÇ   ‚îú‚îÄ‚îÄ AmbientLight (0x404040)
  ‚îÇ   ‚îî‚îÄ‚îÄ DirectionalLight (0xffffff, 0.5)
  ‚îú‚îÄ‚îÄ OrbitControls
  ‚îî‚îÄ‚îÄ Molecule Group (adicionado dinamicamente)
```

**Sistema de Raycasting**:
- Detecta cliques em √°tomos
- Calcula intersec√ß√µes 3D
- Exibe informa√ß√µes em popup

**Auto-centraliza√ß√£o**:
1. Calcula bounding box da mol√©cula
2. Centraliza em rela√ß√£o √† origem
3. Ajusta c√¢mera para enquadrar
4. Dist√¢ncia calculada dinamicamente

**Controles dispon√≠veis**:
- Rota√ß√£o: Arrastar com bot√£o esquerdo
- Zoom: Scroll do mouse
- Pan: Bot√£o direito + arrastar

---

## Padr√µes de Design Utilizados

### 1. **Module Pattern**
Cada arquivo JS √© um m√≥dulo independente com fun√ß√µes p√∫blicas e privadas.

### 2. **Separation of Concerns**
- Parsing ‚â† Renderiza√ß√£o ‚â† Interface
- Cada m√≥dulo tem responsabilidade √∫nica

### 3. **Dependency Injection**
Fun√ß√µes recebem depend√™ncias como par√¢metros:
```javascript
createMolecule(atoms, connections, scene)
```

### 4. **Factory Pattern**
Fun√ß√µes que criam objetos Three.js complexos:
```javascript
createBond(atom1, atom2, group, length)
```

### 5. **Strategy Pattern**
Sistema h√≠brido de cria√ß√£o de liga√ß√µes:
- Estrat√©gia 1: CONECT expl√≠cito
- Estrat√©gia 2: C√°lculo por dist√¢ncia

## Decis√µes de Design

### Por que JavaScript Vanilla?
- Simplicidade: Sem build tools
- Performance: Sem overhead de frameworks
- Aprendizado: C√≥digo mais direto
- Portabilidade: Funciona em qualquer navegador moderno

### Por que Three.js?
- Biblioteca madura para WebGL
- Abstra√ß√£o de complexidade 3D
- Grande comunidade
- Documenta√ß√£o extensa

### Por que Sistema H√≠brido de Liga√ß√µes?
- Arquivos PDB nem sempre t√™m CONECT
- C√°lculo autom√°tico garante visualiza√ß√£o
- CONECT tem prioridade quando dispon√≠vel
- Flexibilidade para diferentes fontes

### Por que Cores CPK?
- Padr√£o na qu√≠mica molecular
- Reconhec√≠vel por profissionais
- Cores distintas facilitam identifica√ß√£o

## Extensibilidade

### Como adicionar novo formato de arquivo?

1. Criar novo parser em `js/newFormatParser.js`
2. Implementar fun√ß√£o que retorna `{atoms, connections}`
3. Atualizar `fileLoader.js` para detectar formato
4. N√£o √© necess√°rio alterar renderer

### Como adicionar nova representa√ß√£o 3D?

1. Criar nova fun√ß√£o de renderiza√ß√£o em `moleculeRenderer.js`
2. Exemplo: `createBallAndStick()`, `createSpaceFilling()`
3. Adicionar op√ß√£o na UI
4. Chamar fun√ß√£o apropriada em `index.html`

### Como adicionar novos elementos qu√≠micos?

1. Atualizar `CPK_COLORS` em `moleculeRenderer.js`
2. Atualizar `COVALENT_RADII` se necess√°rio
3. Adicionar a `TWO_LETTER_ELEMENTS` em `pdbParser.js` se for elemento de 2 letras

## Performance

### Otimiza√ß√µes Implementadas

1. **Geometrias reutiliz√°veis**: Mesma geometria para √°tomos do mesmo tipo
2. **Raycasting eficiente**: Apenas em objetos interativos
3. **Renderiza√ß√£o sob demanda**: Apenas quando necess√°rio
4. **C√°lculo de liga√ß√µes otimizado**: Evita compara√ß√µes desnecess√°rias

### Limita√ß√µes Conhecidas

- Mol√©culas muito grandes (>10,000 √°tomos) podem causar lentid√£o
- Recria√ß√£o completa da cena ao trocar mol√©cula
- Sem LOD (Level of Detail) implementado

## Poss√≠veis Melhorias Futuras

1. **Object Pooling**: Reutilizar objetos Three.js
2. **Web Workers**: Parser em thread separada
3. **Instancing**: Para muitos √°tomos id√™nticos
4. **LOD**: Simplificar visualiza√ß√£o de longe
5. **Caching**: Guardar mol√©culas j√° carregadas
6. **Anima√ß√µes**: Transi√ß√µes suaves entre mol√©culas
7. **M√∫ltiplos estilos**: Ball-and-stick, space-filling, ribbon
8. **Exporta√ß√£o**: Salvar imagens/screenshots
9. **Medi√ß√µes**: Dist√¢ncias e √¢ngulos entre √°tomos
10. **Sele√ß√£o m√∫ltipla**: Selecionar v√°rios √°tomos

## Compatibilidade

- **Navegadores suportados**: Chrome, Firefox, Safari, Edge (vers√µes modernas)
- **WebGL**: Requerido
- **ES6**: Necess√°rio (const, arrow functions, template strings)
- **FileReader API**: Para upload de arquivos

## Estrutura de Pastas Recomendada

```
moleculas/
‚îú‚îÄ‚îÄ docs/               # Documenta√ß√£o adicional (futuro)
‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îú‚îÄ‚îÄ core/          # M√≥dulos principais (futuro)
‚îÇ   ‚îú‚îÄ‚îÄ utils/         # Utilit√°rios (futuro)
‚îÇ   ‚îî‚îÄ‚îÄ parsers/       # M√∫ltiplos parsers (futuro)
‚îú‚îÄ‚îÄ pdb/               # Arquivos de exemplo
‚îú‚îÄ‚îÄ tests/             # Testes unit√°rios (futuro)
‚îú‚îÄ‚îÄ assets/            # Imagens, √≠cones (futuro)
‚îî‚îÄ‚îÄ index.html         # Entry point
```
